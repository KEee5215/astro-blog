---
import BlogPost from "../../components/BlogPost.astro";
import BaseLayout from "../../layouts/BaseLayout.astro";

export async function getStaticPaths() {
  const allPosts = await Astro.glob("../posts/*.md");

  //获取所有标签
  const allTags = allPosts
    .flatMap((post: any) => post.frontmatter.tags)
    .filter(
      (tag: string, index: number, arr: string[]) => arr.indexOf(tag) === index,
    );

  return [
    ...allTags.map((tag: string) => ({
      params: { tag },
      props: { posts: allPosts },
    })),
  ];
}

const { tag } = Astro.params;
const { posts } = Astro.props;
// const filteredPosts = posts.filter((post: any) =>
//   post.frontmatter.tags.includes(tag),
// );
---

<BaseLayout pageTitle={tag}>
  <p>包含「{tag}」标签的文章</p>
  <ul>
    {
      posts
        .filter((post: any) => post.frontmatter.tags.includes(tag))
        .map((post: any) => <BlogPost post={post} />)
    }
  </ul>
</BaseLayout>
